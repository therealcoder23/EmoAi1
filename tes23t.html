<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emotion AI Chatbox</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom animations */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .typing-indicator {
            display: flex;
            padding: 8px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            margin: 0 2px;
            background-color: #4f46e5;
            border-radius: 50%;
            animation: pulse 1.5s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.3s; }
        .typing-dot:nth-child(3) { animation-delay: 0.6s; }
        
        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Emotion colors */
        .happy { background-color: #fef08a; color: #854d0e; }
        .sad { background-color: #bfdbfe; color: #1e40af; }
        .romantic { background-color: #fecaca; color: #991b1b; }
        .angry { background-color: #fca5a5; color: #7f1d1d; }
        .excited { background-color: #a7f3d0; color: #065f46; }
        .neutral { background-color: #e5e7eb; color: #4b5563; }

        /* Lobby specific styles */
        .lobby-section {
            padding: 4rem 1rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        .lobby-section:nth-of-type(odd) {
            background-color: #f3f4f6; /* Light gray for alternating sections */
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">
    <header class="bg-indigo-600 text-white shadow-lg fixed w-full z-40">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fas fa-robot text-2xl"></i>
                <h1 class="text-xl font-bold">Emotion AI Chatbox</h1>
            </div>
            <nav class="hidden md:flex space-x-6" id="main-nav">
                <a href="#lobby-features" id="featuresLink" class="hover:text-indigo-200 transition">Features</a>
                <a href="#lobby-about" id="aboutLink" class="hover:text-indigo-200 transition">About</a>
                <a href="#" id="loginBtnHeader" class="hover:text-indigo-200 transition">Sign In</a>
                <button id="tryDemoBtnHeader" class="bg-indigo-700 hover:bg-indigo-800 text-white px-4 py-1 rounded-full transition shadow">Try Demo</button>
            </nav>
            <button class="md:hidden text-xl" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        <div class="md:hidden hidden bg-indigo-700 px-4 py-2" id="mobileMenu">
            <div class="flex flex-col space-y-2">
                <a href="#lobby-features" id="mobileFeaturesLink" class="hover:text-indigo-200 transition">Features</a>
                <a href="#lobby-about" id="mobileAboutLink" class="hover:text-indigo-200 transition">About</a>
                <a href="#" id="mobileLoginBtn" class="hover:text-indigo-200 transition">Sign In</a>
                <button id="mobileTryDemoBtn" class="bg-indigo-800 hover:bg-indigo-900 text-white px-4 py-1 rounded-full transition shadow">Try Demo</button>
            </div>
        </div>
    </header>

    <div id="lobby" class="min-h-screen pt-16">
        <section class="lobby-section bg-gradient-to-r from-indigo-500 to-purple-600 text-white">
            <h2 class="text-4xl md:text-6xl font-extrabold mb-6 animate-float">
                Chat with Emotion
            </h2>
            <p class="text-lg md:text-xl max-w-2xl mb-8">
                Experience AI that understands and responds with nuance, adapting its tone to your chosen emotion.
            </p>
            <button id="tryDemoBtnHero" class="bg-white text-indigo-700 hover:bg-gray-200 text-xl font-bold px-8 py-4 rounded-full shadow-lg transform transition duration-300 hover:scale-105">
                Try Demo Now
            </button>
        </section>

        <section id="lobby-features" class="lobby-section bg-gray-100 text-gray-800">
            <h2 class="text-3xl md:text-4xl font-bold mb-10 text-indigo-700">Explore Our Features</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-5xl w-full">
                <div class="p-6 bg-white rounded-xl shadow-lg transform transition duration-300 hover:scale-105">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-smile-beam text-indigo-600 text-3xl mr-3"></i>
                        <h3 class="font-bold text-xl">Multiple Emotions</h3>
                    </div>
                    <p class="text-gray-700">Change the AI's emotional state to get responses that match different moods: happy, sad, angry, excited, romantic, and neutral.</p>
                </div>
                <div class="p-6 bg-white rounded-xl shadow-lg transform transition duration-300 hover:scale-105">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-brain text-indigo-600 text-3xl mr-3"></i>
                        <h3 class="font-bold text-xl">Context-Aware Responses</h3>
                    </div>
                    <p class="text-gray-700">The AI remembers your conversation and responds intelligently, ensuring continuity and relevance in every interaction.</p>
                </div>
                <div class="p-6 bg-white rounded-xl shadow-lg transform transition duration-300 hover:scale-105">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-mobile-alt text-indigo-600 text-3xl mr-3"></i>
                        <h3 class="font-bold text-xl">Responsive Design</h3>
                    </div>
                    <p class="text-gray-700">Enjoy a seamless experience on any device, whether you're on your phone, tablet, or desktop.</p>
                </div>
                <div class="p-6 bg-white rounded-xl shadow-lg transform transition duration-300 hover:scale-105">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-history text-indigo-600 text-3xl mr-3"></i>
                        <h3 class="font-bold text-xl">Conversation History</h3>
                    </div>
                    <p class="text-gray-700">Sign in to save your chat history and pick up where you left off, anytime, anywhere.</p>
                </div>
                <div class="p-6 bg-white rounded-xl shadow-lg transform transition duration-300 hover:scale-105">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-magic text-indigo-600 text-3xl mr-3"></i>
                        <h3 class="font-bold text-xl">Powered by EmoAi Flash 3.0</h3>
                    </div>
                    <p class="text-gray-700">Leverages the speed and efficiency of Nightfallgaming's EmoAi 3.0 Flash model for rapid and accurate emotional responses.</p>
                </div>
                <div class="p-6 bg-white rounded-xl shadow-lg transform transition duration-300 hover:scale-105">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-comments text-indigo-600 text-3xl mr-3"></i>
                        <h3 class="font-bold text-xl">Engaging Dialogue</h3>
                    </div>
                    <p class="text-gray-700">Experience more human-like conversations as the AI matches tone and content to your chosen emotional prompt.</p>
                </div>
            </div>
        </section>

        <section id="lobby-about" class="lobby-section bg-white text-gray-800">
            <h2 class="text-3xl md:text-4xl font-bold mb-6 text-indigo-700">About Emotion AI Chatbox</h2>
            <p class="text-lg max-w-3xl mb-8">
                Emotion AI Chatbox is a cutting-edge chatbot designed to make AI interactions more intuitive and engaging. Unlike traditional chatbots, it can adapt its responses based on a range of emotional states, providing a uniquely personalized conversational experience.
            </p>
            <p class="text-md max-w-3xl mb-10">
                Our mission is to explore the frontiers of human-AI communication, creating tools that are not just intelligent, but also emotionally intelligent. This demo showcases our commitment to building more empathetic and responsive AI.
            </p>
            <button id="tryDemoBtnAbout" class="bg-indigo-600 text-white hover:bg-indigo-700 text-lg font-semibold px-6 py-3 rounded-full shadow-md transform transition duration-300 hover:scale-105">
                Start Chatting
            </button>
        </section>
    </div>

    <main id="chatbox" class="flex-grow container mx-auto px-4 py-6 flex flex-col md:flex-row gap-6 hidden pt-16">
        <div class="flex-grow bg-white rounded-xl shadow-lg overflow-hidden flex flex-col max-h-[calc(100vh-8rem)]">
            <div class="bg-indigo-600 text-white p-4 flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-full bg-indigo-500 flex items-center justify-center">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div>
                        <h2 class="font-bold">Emotion AI</h2>
                        <p class="text-xs opacity-80" id="currentEmotion">Neutral</p>
                    </div>
                </div>
                <div class="flex space-x-2">
                    <button id="happyBtn" class="p-2 rounded-full hover:bg-indigo-500 transition">
                        <i class="fas fa-smile text-yellow-300"></i>
                    </button>
                    <button id="sadBtn" class="p-2 rounded-full hover:bg-indigo-500 transition">
                        <i class="fas fa-sad-tear text-blue-300"></i>
                    </button>
                    <button id="romanticBtn" class="p-2 rounded-full hover:bg-indigo-500 transition">
                        <i class="fas fa-heart text-red-300"></i>
                    </button>
                    <button id="angryBtn" class="p-2 rounded-full hover:bg-indigo-500 transition">
                        <i class="fas fa-angry text-red-500"></i>
                    </button>
                    <button id="excitedBtn" class="p-2 rounded-full hover:bg-indigo-500 transition">
                        <i class="fas fa-star text-green-300"></i>
                    </button>
                    <button id="neutralBtn" class="p-2 rounded-full hover:bg-indigo-500 transition">
                        <i class="fas fa-meh text-gray-300"></i>
                    </button>
                   <button id="infoToggleBtn" class="p-2 rounded-full hover:bg-indigo-500 transition ml-2">
                        <i class="fas fa-info-circle"></i>
                    </button>
                </div>
            </div>
            
            <div id="chatMessages" class="flex-grow p-4 overflow-y-auto custom-scrollbar space-y-4">
            </div>
            
            <div class="border-t p-4 bg-gray-50">
                <form id="chatForm" class="flex gap-2">
                    <input type="text" id="messageInput"
                           class="flex-grow border rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                           placeholder="Type your message..." autocomplete="off">
                    <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </form>
            </div>
        </div>
        
        <div id="chatbox-info-panel" class="md:w-80 bg-white rounded-xl shadow-lg p-6 overflow-y-auto custom-scrollbar max-h-[calc(100vh-8rem)] hidden md:block">
            <h2 class="text-xl font-bold mb-4 text-indigo-700">Information</h2>
            <div class="space-y-6">
                <div class="p-4 bg-indigo-50 rounded-lg">
                    <div class="flex items-center mb-2">
                        <i class="fas fa-info-circle text-indigo-600 mr-2"></i>
                        <h3 class="font-semibold">About This Demo</h3>
                    </div>
                    <p class="text-sm text-gray-700">
                        This chatbox is powered by **Nightfallgaming's EmoAi 3.0 Flash** model, providing fast and emotionally nuanced responses.
                        Select an emotion using the buttons above to guide the AI's tone.
                    </p>
                </div>
                <div class="p-4 bg-indigo-50 rounded-lg">
                    <div class="flex items-center mb-2">
                        <i class="fas fa-lightbulb text-indigo-600 mr-2"></i>
                        <h3 class="font-semibold">Tips</h3>
                    </div>
                    <p class="text-sm text-gray-700">
                        Try changing the emotion mid-conversation to see how the AI adapts.
                        The AI retains conversation context, making interactions more fluid.
                        Type <code class="bg-gray-200 px-1 rounded text-xs">/delete</code> to clear the chat history.
                    </p>
                </div>

                <div id="chatbox-features" class="p-4 bg-gray-50 rounded-lg">
                    <h3 class="font-bold text-xl text-indigo-700 mb-3">Our Features</h3>
                    <ul class="list-disc pl-5 space-y-2 text-sm text-gray-700">
                        <li>**Multiple Emotions:** Interact with AI in various moods like happy, sad, angry, excited, romantic, and neutral.</li>
                        <li>**Context-Aware:** The AI remembers your conversation for intelligent, continuous dialogue.</li>
                        <li>**Responsive Design:** Seamless experience across all your devices.</li>
                        <li>**Conversation History:** (Sign-in required) Save and resume chats anytime.</li>
                        <li>**Powered by EmoAi Flash:** Fast and accurate emotional responses.</li>
                        <li>**Engaging Dialogue:** More human-like conversations with adaptive tone.</li>
                    </ul>
                </div>

                <div id="chatbox-about" class="p-4 bg-gray-50 rounded-lg">
                    <h3 class="font-bold text-xl text-indigo-700 mb-3">About Emotion AI Chatbox</h3>
                    <p class="text-sm text-gray-700 mb-2">
                        Emotion AI Chatbox is a cutting-edge chatbot designed to make AI interactions more intuitive and engaging. It adapts responses based on emotional states, offering a uniquely personalized conversational experience.
                    </p>
                    <p class="text-sm text-gray-700">
                        Our mission is to explore the frontiers of human-AI communication, building tools that are not just intelligent, but also emotionally intelligent.
                    </p>
                </div>

                <div class="p-4 bg-indigo-50 rounded-lg">
                    <h3 class="font-semibold mb-2">Latest Updates:</h3>
                    <ul class="list-disc pl-5 space-y-1 text-sm">
                        <li><span class="font-medium">v1.4 (Current):</span> AI emotion responses refined for smoother, more intelligent delivery. Added <code class="bg-gray-200 px-1 rounded text-xs">/delete</code> command to remove chat history.</li>
                        <li><span class="font-medium">v1.3:</span> Added interactive lobby and chatbox transition.</li>
                        <li><span class="font-medium">v1.2:</span> Updated to EmoAi 3.0 Flash model and removed AI core selection.</li>
                        <li><span class="font-medium">v1.1:</span> Enhanced emotional responses with deeper context.</li>
                        <li><span class="font-medium">v1.0:</span> Initial release with basic emotion switching.</li>
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-gray-800 text-white py-6 mt-auto">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <h3 class="text-lg font-bold">Emotion AI Chatbox</h3>
                    <p class="text-sm text-gray-400">Making conversations more human-like</p>
                </div>
                <div class="flex space-x-6">
                    <a href="#" id="termsBtn" class="text-sm hover:text-indigo-300 transition">Terms of Service</a>
                    <a href="#" id="privacyBtn" class="text-sm hover:text-indigo-300 transition">Privacy Policy</a>
                    <a href="mailto:support@emotionai.com" class="text-sm hover:text-indigo-300 transition">Contact Us</a>
                </div>
            </div>
            <div class="mt-6 pt-6 border-t border-gray-700 text-center text-sm text-gray-400">
                <p>&copy; 2025 Emotion AI Chatbox. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 w-full max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-indigo-700">Sign In</h2>
                <button id="closeLoginModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="loginForm" class="space-y-4">
                <div>
                    <label for="loginEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" id="loginEmail" class="w-full border rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                </div>
                <div>
                    <label for="loginPassword" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="loginPassword" class="w-full border rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                </div>
                <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition">
                    Sign In
                </button>
            </form>
            <div class="mt-4 text-center">
                <p class="text-sm text-gray-600">Don't have an account? <a href="#" id="showRegister" class="text-indigo-600 hover:underline">Register</a></p>
            </div>
        </div>
    </div>

    <div id="registerModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 w-full max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-indigo-700">Create Account</h2>
                <button id="closeRegisterModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="registerForm" class="space-y-4">
                <div>
                    <label for="registerName" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                    <input type="text" id="registerName" class="w-full border rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                </div>
                <div>
                    <label for="registerEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" id="registerEmail" class="w-full border rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                </div>
                <div>
                    <label for="registerPassword" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="registerPassword" class="w-full border rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                </div>
                <div>
                    <label for="registerConfirmPassword" class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
                    <input type="password" id="registerConfirmPassword" class="w-full border rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                </div>
                <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition">
                    Register
                </button>
            </form>
            <div class="mt-4 text-center">
                <p class="text-sm text-gray-600">Already have an account? <a href="#" id="showLogin" class="text-indigo-600 hover:underline">Sign In</a></p>
            </div>
        </div>
    </div>

    <div id="termsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-indigo-700">Terms of Service</h2>
                <button id="closeTermsModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="text-sm text-gray-700 space-y-4">
                <p>Last updated: July 2025</p>
                
                <h3 class="font-bold text-lg">1. Acceptance of Terms</h3>
                <p>By accessing or using the Emotion AI Chatbox service ("Service"), you agree to be bound by these Terms of Service ("Terms"). If you disagree with any part of the terms, you may not access the Service.</p>
                
                <h3 class="font-bold text-lg">2. Description of Service</h3>
                <p>The Service provides an AI-powered chatbot that can simulate different emotional states in its responses. The Service is provided for entertainment and informational purposes only.</p>
                
                <h3 class="font-bold text-lg">3. User Conduct</h3>
                <p>You agree not to use the Service to:</p>
                <ul class="list-disc pl-5 space-y-1">
                    <li>Violate any laws or regulations</li>
                    <li>Infringe upon the rights of others</li>
                    <li>Transmit any harmful or offensive content</li>
                    <li>Interfere with or disrupt the Service</li>
                    <li>... (Other terms) ...</li>
                </ul>
                
                <h3 class="font-bold text-lg">4. Privacy</h3>
                <p>Your use of the Service is subject to our Privacy Policy, which explains how we collect, use, and protect your information.</p>
                
                <h3 class="font-bold text-lg">5. Limitation of Liability</h3>
                <p>The Service is provided "as is" without warranties of any kind. We shall not be liable for any damages resulting from your use of the Service.</p>
                
                <h3 class="font-bold text-lg">6. Changes to Terms</h3>
                <p>We reserve the right to modify these Terms at any time. Your continued use of the Service after such changes constitutes your acceptance of the new Terms.</p>
            </div>
        </div>
    </div>

    <div id="privacyModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-indigo-700">Privacy Policy</h2>
                <button id="closePrivacyModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="text-sm text-gray-700 space-y-4">
                <p>Last updated: July 2025</p>
                
                <h3 class="font-bold text-lg">1. Information We Collect</h3>
                <p>When you use our Service, we may collect:</p>
                <ul class="list-disc pl-5 space-y-1">
                    <li>Information you provide (account details, messages)</li>
                    <li>Usage data (interaction with the Service)</li>
                    <li>Technical data (device information, IP address)</li>
                </ul>
                
                <h3 class="font-bold text-lg">2. How We Use Your Information</h3>
                <p>We use the information we collect to:</p>
                <ul class="list-disc pl-5 space-y-1">
                    <li>Provide and maintain the Service</li>
                    <li>Improve and personalize your experience</li>
                    <li>Analyze usage patterns</li>
                    <li>Share with third parties (if applicable and consented)</li>
                    <li>Communicate with you</li>
                </ul>
                
                <h3 class="font-bold text-lg">3. Data Security</h3>
                <p>We implement appropriate security measures to protect your information. However, no method of transmission over the Internet is 100% secure.</p>
                
                <h3 class="font-bold text-lg">4. Data Retention</h3>
                <p>We retain your information only as long as necessary to provide the Service and for legitimate business purposes.</p>
                
                <h3 class="font-bold text-lg">5. Your Rights</h3>
                <p>Depending on your jurisdiction, you may have rights regarding your personal information, including access, correction, and deletion.</p>
                
                <h3 class="font-bold text-lg">6. Changes to This Policy</h3>
                <p>We may update our Privacy Policy from time to time. We will notify you of any changes by posting the new policy on this page.</p>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const chatForm = document.getElementById('chatForm');
        const currentEmotion = document.getElementById('currentEmotion');
        const chatbox = document.getElementById('chatbox'); // The main chat content
        const lobby = document.getElementById('lobby');     // The lobby section
        
        // Emotion buttons
        const happyBtn = document.getElementById('happyBtn');
        const sadBtn = document.getElementById('sadBtn');
        const romanticBtn = document.getElementById('romanticBtn');
        const angryBtn = document.getElementById('angryBtn');
        const excitedBtn = document.getElementById('excitedBtn');
        const neutralBtn = document.getElementById('neutralBtn');
        const infoToggleBtn = document.getElementById('infoToggleBtn');
        const chatboxInfoPanel = document.getElementById('chatbox-info-panel');
        
        // Lobby and Chatbox transition buttons
        const tryDemoBtnHero = document.getElementById('tryDemoBtnHero');
        const tryDemoBtnAbout = document.getElementById('tryDemoBtnAbout');
        const tryDemoBtnHeader = document.getElementById('tryDemoBtnHeader');
        const mobileTryDemoBtn = document.getElementById('mobileTryDemoBtn');
        
        // Header navigation links for lobby
        const featuresLink = document.getElementById('featuresLink');
        const aboutLink = document.getElementById('aboutLink');
        const mobileFeaturesLink = document.getElementById('mobileFeaturesLink');
        const mobileAboutLink = document.getElementById('mobileAboutLink');

        // Main navigation elements
        const mainNav = document.getElementById('main-nav');
        const mobileMenu = document.getElementById('mobileMenu');

        // Modal elements
        const loginModal = document.getElementById('loginModal');
        const registerModal = document.getElementById('registerModal');
        const termsModal = document.getElementById('termsModal');
        const privacyModal = document.getElementById('privacyModal');
        
        // Modal buttons
        const loginBtnHeader = document.getElementById('loginBtnHeader');
        const mobileLoginBtn = document.getElementById('mobileLoginBtn');
        const closeLoginModal = document.getElementById('closeLoginModal');
        const showRegister = document.getElementById('showRegister');
        const closeRegisterModal = document.getElementById('closeRegisterModal');
        const showLogin = document.getElementById('showLogin');
        const termsBtn = document.getElementById('termsBtn');
        const closeTermsModal = document.getElementById('closeTermsModal');
        const privacyBtn = document.getElementById('privacyBtn');
        const closePrivacyModal = document.getElementById('closePrivacyModal');
        
        // Mobile menu toggle button
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        
        // State
        let currentEmotionState = 'neutral';
        // conversationHistory will store objects like { role: "user", parts: [{ text: "..." }] }
        let conversationHistory = [];
        
        // Define your API Key (REMINDER: Not secure for production! Replace with your actual key!)
        // Get your key from Google AI Studio: https://aistudio.google.com/app/apikey
        const GEMINI_API_KEY = "AIzaSyCki1_Qq8HhQdqUBA000HgSibr2T0CdOkk"; 

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Set default emotion
            updateEmotion('neutral', false); // Don't append initial message for default neutral

            // Load any saved conversation from localStorage
            const savedConversation = localStorage.getItem('aiConversation');
            if (savedConversation) {
                try {
                    const parsedHistory = JSON.parse(savedConversation);
                    // Basic validation to ensure it's an array and has expected structure
                    if (Array.isArray(parsedHistory) && parsedHistory.every(item => item.role && item.parts && Array.isArray(item.parts))) {
                         conversationHistory = parsedHistory;
                         conversationHistory.forEach(message => {
                             // Re-append messages to UI, using a generic 'neutral' emotion for display if not stored
                             appendMessage(message.parts[0].text, message.role === 'user' ? 'user' : 'ai', message.emotion || 'neutral');
                         });
                         scrollToBottom();
                    } else {
                        console.warn("Invalid conversation history format in localStorage. Clearing history.");
                        localStorage.removeItem('aiConversation');
                        conversationHistory = [];
                    }
                } catch (e) {
                    console.error("Error parsing conversation history from localStorage:", e);
                    localStorage.removeItem('aiConversation');
                    conversationHistory = [];
                }
            }

            // Handle navigation for Features/About in header to show within chatbox info panel
            const handleInfoPanelNavigation = function(event) {
                event.preventDefault();
                const targetId = this.getAttribute('href').substring(1);
                const targetElement = document.getElementById(targetId);
                if (lobby.classList.contains('hidden')) { // If chatbox is visible
                    if (targetElement && chatboxInfoPanel.classList.contains('md:block')) { // Ensure panel is visible on large screens
                         // Scroll to the corresponding section within the info panel
                        chatboxInfoPanel.scrollTop = targetElement.offsetTop - chatboxInfoPanel.offsetTop;
                    } else { // If info panel is hidden (mobile or smaller screens)
                        infoToggleBtn.click(); // Toggle info panel visible
                        // Wait for panel to become visible, then scroll (might need a slight delay)
                        setTimeout(() => {
                            if (targetElement) {
                                chatboxInfoPanel.scrollTop = targetElement.offsetTop - chatboxInfoPanel.offsetTop;
                            }
                        }, 100);
                    }
                } else { // If lobby is visible, scroll to lobby sections
                     const lobbySection = document.getElementById(targetId);
                     if (lobbySection) {
                         lobbySection.scrollIntoView({ behavior: 'smooth' });
                     }
                }
                if (mobileMenu.classList.contains('flex')) {
                    mobileMenu.classList.remove('flex');
                    mobileMenu.classList.add('hidden');
                }
            };

            featuresLink.addEventListener('click', handleInfoPanelNavigation);
            aboutLink.addEventListener('click', handleInfoPanelNavigation);
            mobileFeaturesLink.addEventListener('click', handleInfoPanelNavigation);
            mobileAboutLink.addEventListener('click', handleInfoPanelNavigation);

            // --- Chatbox / Lobby Transition ---
            const switchToChatbox = () => {
                lobby.classList.add('hidden');
                chatbox.classList.remove('hidden');
                document.body.classList.add('flex', 'flex-col'); // Ensure body is flex for chatbox layout
                document.body.classList.remove('bg-gray-100'); // Remove lobby background
                document.body.style.minHeight = '100vh'; // Ensure full height
                scrollToBottom();

                // Adjust header navigation visibility for chatbox mode
                featuresLink.classList.add('hidden');
                aboutLink.classList.add('hidden');
                loginBtnHeader.classList.add('hidden');
                tryDemoBtnHeader.classList.remove('hidden'); // This button is now the "Go to Lobby" button

                mobileFeaturesLink.classList.add('hidden');
                mobileAboutLink.classList.add('hidden');
                mobileLoginBtn.classList.add('hidden');
                mobileTryDemoBtn.classList.remove('hidden');
            };

            const switchToLobby = () => {
                chatbox.classList.add('hidden');
                lobby.classList.remove('hidden');
                document.body.classList.remove('flex', 'flex-col');
                document.body.classList.add('bg-gray-100');
                document.body.style.minHeight = ''; // Reset min-height

                // Adjust header navigation visibility for lobby mode
                featuresLink.classList.remove('hidden');
                aboutLink.classList.remove('hidden');
                loginBtnHeader.classList.remove('hidden');
                tryDemoBtnHeader.classList.add('hidden'); // This button is now hidden in lobby

                mobileFeaturesLink.classList.remove('hidden');
                mobileAboutLink.classList.remove('hidden');
                mobileLoginBtn.classList.remove('hidden');
                mobileTryDemoBtn.classList.add('hidden');
            };


            tryDemoBtnHero.addEventListener('click', switchToChatbox);
            tryDemoBtnAbout.addEventListener('click', switchToChatbox);
            // Change the header "Try Demo" button to go back to lobby
            tryDemoBtnHeader.addEventListener('click', switchToLobby);
            mobileTryDemoBtn.addEventListener('click', switchToLobby);

            // If the URL has #chatbox, automatically switch to chatbox view
            if (window.location.hash === '#chatbox') {
                switchToChatbox();
            } else {
                switchToLobby(); // Ensure lobby is shown by default
            }

            // --- Modal Logic ---
            const openModal = (modalElement) => {
                modalElement.classList.remove('hidden');
            };

            const closeModal = (modalElement) => {
                modalElement.classList.add('hidden');
            };

            loginBtnHeader.addEventListener('click', () => openModal(loginModal));
            mobileLoginBtn.addEventListener('click', () => {
                openModal(loginModal);
                // Close mobile menu if open
                if (mobileMenu.classList.contains('flex')) {
                    mobileMenu.classList.remove('flex');
                    mobileMenu.classList.add('hidden');
                }
            });
            closeLoginModal.addEventListener('click', () => closeModal(loginModal));

            showRegister.addEventListener('click', (e) => {
                e.preventDefault();
                closeModal(loginModal);
                openModal(registerModal);
            });

            closeRegisterModal.addEventListener('click', () => closeModal(registerModal));
            showLogin.addEventListener('click', (e) => {
                e.preventDefault();
                closeModal(registerModal);
                openModal(loginModal);
            });

            termsBtn.addEventListener('click', (e) => {
                e.preventDefault();
                openModal(termsModal);
            });
            closeTermsModal.addEventListener('click', () => closeModal(termsModal));

            privacyBtn.addEventListener('click', (e) => {
                e.preventDefault();
                openModal(privacyModal);
            });
            closePrivacyModal.addEventListener('click', () => closeModal(privacyModal));

            // Close modals if clicking outside (on the overlay)
            [loginModal, registerModal, termsModal, privacyModal].forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeModal(modal);
                    }
                });
            });

            // --- Mobile Menu Toggle ---
            mobileMenuBtn.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
                mobileMenu.classList.toggle('flex');
            });

            // --- Chatbox Functionality ---
            function appendMessage(text, sender, emotion = 'neutral') {
                const messageElement = document.createElement('div');
                messageElement.classList.add('flex', 'items-end', 'mb-2');

                if (sender === 'user') {
                    messageElement.classList.add('justify-end');
                    messageElement.innerHTML = `
                        <div class="bg-indigo-500 text-white p-3 rounded-lg max-w-[70%] shadow-md">
                            ${text}
                        </div>
                    `;
                } else {
                    messageElement.classList.add('justify-start');
                    messageElement.innerHTML = `
                        <div class="w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center mr-2 flex-shrink-0">
                            <i class="fas fa-robot text-gray-600"></i>
                        </div>
                        <div class="p-3 rounded-lg max-w-[70%] shadow-md ai-message ${emotion}">
                            ${text}
                        </div>
                    `;
                }
                chatMessages.appendChild(messageElement);
                scrollToBottom();
            }

            function scrollToBottom() {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            function showTypingIndicator() {
                const typingIndicator = document.createElement('div');
                typingIndicator.classList.add('typing-indicator', 'mb-2');
                typingIndicator.id = 'typingIndicator';
                typingIndicator.innerHTML = `
                    <div class="w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center mr-2 flex-shrink-0">
                        <i class="fas fa-robot text-gray-600"></i>
                    </div>
                    <div class="p-3 rounded-lg bg-gray-200 text-gray-700 shadow-md flex items-center">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                `;
                chatMessages.appendChild(typingIndicator);
                scrollToBottom();
            }

            function hideTypingIndicator() {
                const typingIndicator = document.getElementById('typingIndicator');
                if (typingIndicator) {
                    typingIndicator.remove();
                }
            }

            async function fetchAIResponse(emotion) {
                showTypingIndicator();

                let payloadHistory = JSON.parse(JSON.stringify(conversationHistory));

                if (payloadHistory.length === 0 || payloadHistory[payloadHistory.length - 1].role !== 'user') {
                    console.error("Invalid conversation history state before AI API call. Expected last message to be from user.");
                    hideTypingIndicator();
                    appendMessage("An internal error occurred while preparing your message. Please refresh and try again.", 'ai', 'sad');
                    return;
                }

                const lastUserMessageInPayload = payloadHistory[payloadHistory.length - 1];
                const originalUserText = lastUserMessageInPayload.parts[0].text;
                
                lastUserMessageInPayload.parts[0].text = `(As an AI, respond in a ${emotion} tone. Maintain context of the conversation. If the user asks to change emotion, acknowledge and change your tone. If the user types '/delete', inform them you've cleared the history.) ${originalUserText}`;

                const contentsToSend = payloadHistory.slice(Math.max(0, payloadHistory.length - 20));

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${GEMINI_API_KEY}`, { // CHANGED MODEL HERE
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: contentsToSend,
                        }),
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        console.error('API Error Response:', errorData);
                        let errorMessage = "An error occurred with the AI response.";

                        if (response.status === 400) {
                             if (errorData.error && errorData.error.details && errorData.error.details[0] && errorData.error.details[0].reason === 'UNSUPPORTED_REPRESENTATION') {
                                errorMessage = "The AI could not process the request. This might be due to an invalid input format or content.";
                            } else if (errorData.error && errorData.error.message && errorData.error.message.includes("API key not valid")) {
                                errorMessage = "Your API key is invalid or has expired. Please check your configuration.";
                            } else if (errorData.error && errorData.error.message) {
                                errorMessage = `Bad request (Status 400): ${errorData.error.message}`;
                            }
                        } else if (response.status === 429) {
                            errorMessage = "Too many requests. Please wait a moment before sending another message.";
                        } else if (response.status === 500) {
                            errorMessage = "Internal server error. The AI service might be temporarily down.";
                        } else {
                            errorMessage = `API error ${response.status}: ${errorData.error.message || 'Unknown error'}`;
                        }
                        throw new Error(errorMessage);
                    }

                    const data = await response.json();
                    hideTypingIndicator();

                    let aiResponseText = "Sorry, I couldn't get a response from the AI.";
                    if (data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts && data.candidates[0].content.parts[0]) {
                        aiResponseText = data.candidates[0].content.parts[0].text;
                    } else if (data.promptFeedback && data.promptFeedback.blockReason) {
                        aiResponseText = `I'm sorry, your request was blocked due to: ${data.promptFeedback.blockReason.toLowerCase().replace(/_/g, ' ')}. Please try rephrasing your message.`;
                    } else {
                        console.error("Unexpected API response structure or no candidate:", data);
                        aiResponseText = "I received an unexpected response from the AI. Please try again.";
                    }

                    conversationHistory.push({ role: "model", parts: [{ text: aiResponseText }] });
                    localStorage.setItem('aiConversation', JSON.stringify(conversationHistory));

                    appendMessage(aiResponseText, 'ai', emotion);

                } catch (error) {
                    console.error('Error fetching AI response:', error);
                    hideTypingIndicator();
                    appendMessage(`An error occurred: ${error.message}.`, 'ai', 'sad');
                }
            }

            // --- Event Listeners ---
            chatForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const message = messageInput.value.trim();
                if (message) {
                    if (message.toLowerCase() === '/delete') {
                        conversationHistory = [];
                        localStorage.removeItem('aiConversation');
                        chatMessages.innerHTML = `
                            <div class="text-center text-gray-500 text-sm italic">Chat history cleared.</div>
                        `;
                        appendMessage("I've cleared our conversation history.", 'ai', 'neutral');
                        messageInput.value = '';
                        return;
                    }

                    appendMessage(message, 'user');
                    conversationHistory.push({ role: "user", parts: [{ text: message }] });
                    messageInput.value = '';

                    await fetchAIResponse(currentEmotionState);
                }
            });

            function updateEmotion(emotion, showMessage = true) {
                currentEmotionState = emotion;
                currentEmotion.textContent = emotion.charAt(0).toUpperCase() + emotion.slice(1);
                
                if (showMessage) {
                    appendMessage(`My emotion is now set to **${emotion}**. How can I help you?`, 'ai', emotion);
                }
            }

            happyBtn.addEventListener('click', () => updateEmotion('happy'));
            sadBtn.addEventListener('click', () => updateEmotion('sad'));
            romanticBtn.addEventListener('click', () => updateEmotion('romantic'));
            angryBtn.addEventListener('click', () => updateEmotion('angry'));
            excitedBtn.addEventListener('click', () => updateEmotion('excited'));
            neutralBtn.addEventListener('click', () => updateEmotion('neutral'));

            infoToggleBtn.addEventListener('click', () => {
                chatboxInfoPanel.classList.toggle('hidden');
                chatboxInfoPanel.classList.toggle('md:block');
            });

            if (window.innerWidth >= 768) {
                chatboxInfoPanel.classList.remove('hidden');
                chatboxInfoPanel.classList.add('md:block');
            }
        });
    </script>
</body>
</html>